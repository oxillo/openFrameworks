name: MSYS2 GHA
on: [push, pull_request]

jobs:
  msys2:
    runs-on: windows-latest
    strategy:
      matrix:
        mingw: [MINGW64,MINGW32]
    defaults:
      run:
        shell: msys2 {0}
    env: 
      MSYSTEM: ${{ matrix.mingw }}
    steps:
      - uses: actions/checkout@v2
      - uses: msys2/setup-msys2@v2
        with:
          update: true
          install: >-
            git
            unzip
            rsync
            wget
      - name: Install dependencies
        run: |
          echo 'Installing dependencies!'
          ./scripts/ci/msys2/install.sh
      - name: Build
        run: |
          echo 'Building Of'
          ./scripts/ci/msys2/build.sh
      - name: Run Tests
        run: |
          echo 'Running Test'
          ./scripts/ci/msys2/run_tests.sh

  vs2017:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: msys2/setup-msys2@v2
        with:
          update: true
          install: >-
            git
            unzip
            rsync
            wget
      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v1.0.2
      
      - name: Build
        working-directory: ${{env.GITHUB_WORKSPACE}}
        # Add additional options to the MSBuild command line here (like platform or verbosity level).
        # See https://docs.microsoft.com/visualstudio/msbuild/msbuild-command-line-reference
        #msbuild libs/openFrameworksCompiled/project/vs/openframeworksLib.vcxproj
        #run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} ${{env.SOLUTION_FILE_PATH}}
        run:
          msbuild libs/openFrameworksCompiled/project/vs/openframeworksLib.vcxproj
